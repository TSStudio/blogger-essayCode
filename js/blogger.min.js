var response,totalpages,curPage=1,blocked=0,curId=0;function getRemoteAssets(t,e){xhttp=new XMLHttpRequest,xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&(response=this.responseText,e())},xhttp.open("GET",t,!0),xhttp.send()}function loadcontents(t=1){if(!blocked){passagelist=document.getElementById("passagelist"),read=document.getElementById("read");try{passagelist.classList.remove("hidden")}catch(t){}try{read.classList.add("hidden")}catch(t){}pageinfo=document.getElementById("pageInfo"),pageinfo.innerHTML="广场",curPage=t,1==t?(blocked=1,getRemoteAssets("https://www.tmysam.top/blogger/apis/getContents.php?from=-1",loadcontentsStage2)):(blocked=1,getRemoteAssets("https://www.tmysam.top/blogger/apis/getContents.php?from="+(10*(t-1)).toString(),loadcontentsStage2))}}function datetimeparser(t){return d=new Date,d.setTime(1e3*t),d.format("yyyy-MM-dd hh:mm:ss")}function swpg(t=0){blocked||(0==t&&(ipg=document.getElementById("pageno"),t=parseInt(ipg.value),isNaN(t))?ipg.value=curPage:t<1||t>totalpages?ipg.value=curPage:loadcontents(t))}function loadcontentsStage2(){for(passagelist=document.getElementById("passagelist"),pageinfo=document.getElementById("pageInfo"),pageinfo.innerHTML="广场",contents=JSON.parse(response),totalpages=Math.ceil(contents.total/10),str='<div class="pageselector">',curPage>1&&(str=str+'<a href="#" onclick="swpg('+(curPage-1).toString()+')" class="back">上一页</a>'),str=str+'第 <input id="pageno" type="text" style="width:20px" onchange="swpg()" value="'+curPage.toString()+'"> 页，共 '+totalpages.toString()+" 页",curPage<totalpages&&(str=str+'<a href="#" onclick="swpg('+(curPage+1).toString()+')" class="back">下一页</a>'),str+="</div>",i=0;i<contents.articles.length;i++)str=str+'<div class="passagebutton" onclick="loadpassage('+contents.articles[i].id.toString()+')"><p class="datetime">'+datetimeparser(contents.articles[i].lastedit)+'</p><p class="titlebutton">'+contents.articles[i].title+"</p></div>";passagelist.innerHTML=str,state={},state.name="contents",state.page=curPage,history.replaceState(state,"","https://www.tmysam.top/"),blocked=0}function loadpassage(t){if(!blocked){pageinfo=document.getElementById("pageInfo"),pageinfo.innerHTML='<a href="#" onclick="loadcontents('+curPage.toString()+')" class="back"><i class="iconfont">&#xe600;</i>返回</a>',passagelist=document.getElementById("passagelist"),read=document.getElementById("read");try{read.classList.remove("hidden")}catch(t){}try{passagelist.classList.add("hidden")}catch(t){}read.innerHTML='<div class="loading">加载中</div>',blocked=1,curId=t,getRemoteAssets("https://www.tmysam.top/blogger/apis/getPassage.php?id="+t.toString(),loadpassageStage2)}}function loadpassageStage2(){if(1==response.error)return blocked=0,void loadcontents();read=document.getElementById("read"),read.innerHTML=parse(JSON.parse(response).content),existFunction("renderMathInElement")&&renderMathInElement(read,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1}),state={},state.name="passage",state.id=curId,history.replaceState(state,"","https://www.tmysam.top/?tid="+curId.toString()),blocked=0}function getQueryVariable(t){for(var e=window.location.search.substring(1).split("&"),s=0;s<e.length;s++){var a=e[s].split("=");if(a[0]==t)return a[1]}return!1}Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var s in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),e)new RegExp("("+s+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[s]:("00"+e[s]).substr((""+e[s]).length)));return t},window.onload=function(){getQueryVariable("tid")?isNaN(parseInt(getQueryVariable("tid")))?loadcontents():loadpassage(parseInt(getQueryVariable("tid"))):loadcontents(),window.addEventListener("popstate",function(t){state=t.state,null!=state?"passage"==state.name?loadpassage(state.id):loadcontents(state.page):history.back()},!1)};